<h1>Pixel manipulation with canvas</h1> <ul class="prev-next"> <li><a class="button minimal" href="advanced_animations">« Previous</a></li> <li><a class="button minimal" href="hit_regions_and_accessibility">Next »</a></li> </ul> <div class="summary"> <p>Until now we haven't looked at the actual pixels of our canvas. With the <code>ImageData</code> object you can directly read and write a data array to manipulate pixel data. We will also look into how image smoothing (anti-aliasing) can be controlled and how to save images from your canvas.</p> </div>
<h2 id="the_imagedata_object">The ImageData object</h2>
<p>The <a href="../../imagedata"><code>ImageData</code></a> object represents the underlying pixel data of an area of a canvas object. It contains the following read-only attributes:</p> <dl> <dt><code>width</code></dt> <dd>The width of the image in pixels.</dd> <dt><code>height</code></dt> <dd>The height of the image in pixels.</dd> <dt><code>data</code></dt> <dd>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray"><code>Uint8ClampedArray</code></a> representing a one-dimensional array containing the data in the RGBA order, with integer values between <code>0</code> and <code>255</code> (included).</dd> </dl> <p>The <code>data</code> property returns a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray"><code>Uint8ClampedArray</code></a> which can be accessed to look at the raw pixel data; each pixel is represented by four one-byte values (red, green, blue, and alpha, in that order; that is, "RGBA" format). Each color component is represented by an integer between 0 and 255. Each component is assigned a consecutive index within the array, with the top left pixel's red component being at index 0 within the array. Pixels then proceed from left to right, then downward, throughout the array.</p> <p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray"><code>Uint8ClampedArray</code></a> contains <code>height</code> × <code>width</code> × 4 bytes of data, with index values ranging from 0 to (<code>height</code>×<code>width</code>×4)-1.</p> <p>For example, to read the blue component's value from the pixel at column 200, row 50 in the image, you would do the following:</p> <pre data-language="js">blueComponent <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">50</span> <span class="token operator">*</span> <span class="token punctuation">(</span>imageData<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">200</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre> <p>If given a set of coordinates (X and Y), you may end up doing something like this:</p> <pre data-language="js"><span class="token keyword">var</span> xCoord <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> yCoord <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> canvasWidth <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getColorIndicesForCoord</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> red <span class="token operator">=</span> y <span class="token operator">*</span> <span class="token punctuation">(</span>width <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> x <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>red<span class="token punctuation">,</span> red <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> red <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> red <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> colorIndices <span class="token operator">=</span> <span class="token function">getColorIndicesForCoord</span><span class="token punctuation">(</span>xCoord<span class="token punctuation">,</span> yCoord<span class="token punctuation">,</span> canvasWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> redIndex <span class="token operator">=</span> colorIndices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> greenIndex <span class="token operator">=</span> colorIndices<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blueIndex <span class="token operator">=</span> colorIndices<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> alphaIndex <span class="token operator">=</span> colorIndices<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> redForCoord <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>redIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> greenForCoord <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>greenIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> blueForCoord <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>blueIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> alphaForCoord <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>alphaIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
</pre> <p>Or, if ES2015 is appropriate:</p> <pre data-language="js"><span class="token keyword">const</span> xCoord <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> yCoord <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> canvasWidth <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getColorIndicesForCoord</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> red <span class="token operator">=</span> y <span class="token operator">*</span> <span class="token punctuation">(</span>width <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> x <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>red<span class="token punctuation">,</span> red <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> red <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> red <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> colorIndices <span class="token operator">=</span> <span class="token function">getColorIndicesForCoord</span><span class="token punctuation">(</span>xCoord<span class="token punctuation">,</span> yCoord<span class="token punctuation">,</span> canvasWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">[</span>redIndex<span class="token punctuation">,</span> greenIndex<span class="token punctuation">,</span> blueIndex<span class="token punctuation">,</span> alphaIndex<span class="token punctuation">]</span> <span class="token operator">=</span> colorIndices<span class="token punctuation">;</span>
</pre> <p>You may also access the size of the pixel array in bytes by reading the <code>Uint8ClampedArray.length</code> attribute:</p> <pre data-language="js"><span class="token keyword">var</span> numBytes <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
</pre>
<h2 id="creating_an_imagedata_object">Creating an ImageData object</h2>
<p>To create a new, blank <code>ImageData</code> object, you should use the <a href="../../canvasrenderingcontext2d/createimagedata"><code>createImageData()</code></a> method. There are two versions of the <code>createImageData()</code> method:</p> <pre data-language="js"><span class="token keyword">var</span> myImageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createImageData</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span></pre> <p>This creates a new <code>ImageData</code> object with the specified dimensions. All pixels are preset to transparent black (all zeroes i.e rgba(0,0,0,0)).</p> <p>You can also create a new <code>ImageData</code> object with the same dimensions as the object specified by <code>anotherImageData</code>. The new object's pixels are all preset to transparent black. <strong>This does not copy the image data!</strong></p> <pre data-language="js"><span class="token keyword">var</span> myImageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">createImageData</span><span class="token punctuation">(</span>anotherImageData<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
<h2 id="getting_the_pixel_data_for_a_context">Getting the pixel data for a context</h2>
<p>To obtain an <code>ImageData</code> object containing a copy of the pixel data for a canvas context, you can use the <code>getImageData()</code> method:</p> <pre data-language="js"><span class="token keyword">var</span> myImageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span></pre> <p>This method returns an <code>ImageData</code> object representing the pixel data for the area of the canvas whose corners are represented by the points (<code>left</code>,<code>top</code>), (<code>left+width</code>, <code>top</code>), (<code>left</code>, <code>top+height</code>), and (<code>left+width</code>, <code>top+height</code>). The coordinates are specified in canvas coordinate space units.</p> <div class="note notecard"> <p><strong>Note</strong>: Any pixels outside the canvas are returned as transparent black in the resulting <code>ImageData</code> object.</p> </div> <p>This method is also demonstrated in the article <a href="../manipulating_video_using_canvas">Manipulating video using canvas</a>.</p>
<h3 id="a_color_picker">A color picker</h3>
<p>In this example we are using the <a href="../../canvasrenderingcontext2d/getimagedata"><code>getImageData()</code> </a>method to display the color under the mouse cursor. For this, we need the current position of the mouse with <code>layerX</code> and <code>layerY</code>, then we look up the pixel data on that position in the pixel array that <code><a href="../../canvasrenderingcontext2d/getimagedata">getImageData()</a></code> provides us. Finally, we use the array data to set a background color and a text in the <code>&lt;div&gt;</code> to display the color. Clicking on the image will do the same operation but remember what the selected color was.</p> <pre data-language="js"><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'./assets/rhino.jpg'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  img<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> hoveredColor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'hovered-color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> selectedColor <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'selected-color'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">pick</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> destination</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>layerX<span class="token punctuation">;</span>
  <span class="token keyword">var</span> y <span class="token operator">=</span> event<span class="token punctuation">.</span>layerY<span class="token punctuation">;</span>
  <span class="token keyword">var</span> pixel <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> pixel<span class="token punctuation">.</span>data<span class="token punctuation">;</span>

    <span class="token keyword">const</span> rgba <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rgba(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    destination<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> rgba<span class="token punctuation">;</span>
    destination<span class="token punctuation">.</span>textContent <span class="token operator">=</span> rgba<span class="token punctuation">;</span>

    <span class="token keyword">return</span> rgba<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pick</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> hoveredColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">pick</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> selectedColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre> <p>The code's usage is demonstrated in the following live example:</p> <p><iframe width="100%" height="300" src="https://mdn.github.io/dom-examples/canvas/pixel-manipulation/color-picker.html" loading="lazy"></iframe></p> <p>Also see the source code — <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/color-picker.html" rel=" noopener">HTML</a>, <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/color-picker.js" rel=" noopener">JavaScript</a>.</p>
<h2 id="painting_pixel_data_into_a_context">Painting pixel data into a context</h2>
<p>You can use the<a href="../../canvasrenderingcontext2d/putimagedata"> putImageData() </a>method to paint pixel data into a context:</p> <pre data-language="js">ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>myImageData<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre> <p>The <code>dx</code> and <code>dy</code> parameters indicate the device coordinates within the context at which to paint the top left corner of the pixel data you wish to draw.</p> <p>For example, to paint the entire image represented by <code>myImageData</code> to the top left corner of the context, you can do the following:</p> <pre data-language="js">ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>myImageData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
<h3 id="grayscaling_and_inverting_colors">Grayscaling and inverting colors</h3>
<p>In this example we iterate over all pixels to change their values, then we put the modified pixel array back to the canvas using <a href="../../canvasrenderingcontext2d/putimagedata">putImageData()</a>. The invert function subtracts each color from the max value 255. The grayscale function uses the average of red, green and blue. You can also use a weighted average, given by the formula <code>x = 0.299r + 0.587g + 0.114b</code>, for example. See <a href="https://en.wikipedia.org/wiki/Grayscale" rel=" noopener">Grayscale</a> on Wikipedia for more information.</p> <pre data-language="js"><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'./assets/rhino.jpg'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">original</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">invert</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> imageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">[</span>i<span class="token punctuation">]</span>     <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// red</span>
        data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// green</span>
        data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span> <span class="token operator">-</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// blue</span>
    <span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">grayscale</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> imageData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> imageData<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> avg <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">;</span>
        data<span class="token punctuation">[</span>i<span class="token punctuation">]</span>     <span class="token operator">=</span> avg<span class="token punctuation">;</span> <span class="token comment">// red</span>
        data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> avg<span class="token punctuation">;</span> <span class="token comment">// green</span>
        data<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> avg<span class="token punctuation">;</span> <span class="token comment">// blue</span>
    <span class="token punctuation">}</span>
    ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> inputs <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'[name=color]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> input <span class="token keyword">of</span> inputs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"change"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">"inverted"</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token function">invert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"grayscale"</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token function">grayscale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token function">original</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre> <p>The code's usage is demonstrated in the following live example:</p> <p><iframe width="100%" height="300" src="https://mdn.github.io/dom-examples/canvas/pixel-manipulation/color-manipulation.html" loading="lazy"></iframe></p> <p>Also see the source code — <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/color-manipulation.html" rel=" noopener">HTML</a>, <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/color-manipulation.js" rel=" noopener">JavaScript</a>.</p>
<h2 id="zooming_and_anti-aliasing">Zooming and anti-aliasing</h2>
<p>With the help of the <a href="../../canvasrenderingcontext2d/drawimage"><code>drawImage()</code></a> method, a second canvas and the <a href="../../canvasrenderingcontext2d/imagesmoothingenabled"><code>imageSmoothingEnabled</code></a> property, we are able to zoom into our picture and see the details. A third canvas without <a href="../../canvasrenderingcontext2d/imagesmoothingenabled"><code>imageSmoothingEnabled</code></a> is also drawn onto to be able to have a side by side comparison </p> <p>We get the position of the mouse and crop an image of 5 pixels left and above to 5 pixels right and below. Then we copy that one over to another canvas and resize the image to the size we want it to. In the zoom canvas we resize a 10×10 pixel crop of the original canvas to 200×200.</p> <pre data-language="js">zoomctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span>
                  Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre> <p>Zoom example:</p> <pre data-language="js"><span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'./assets/rhino.jpg'</span><span class="token punctuation">;</span>
img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">draw</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token parameter">img</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> smoothedZoomCtx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'smoothed-zoom'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  smoothedZoomCtx<span class="token punctuation">.</span>imageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  smoothedZoomCtx<span class="token punctuation">.</span>mozImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  smoothedZoomCtx<span class="token punctuation">.</span>webkitImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  smoothedZoomCtx<span class="token punctuation">.</span>msImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> pixelatedZoomCtx <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'pixelated-zoom'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  pixelatedZoomCtx<span class="token punctuation">.</span>imageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  pixelatedZoomCtx<span class="token punctuation">.</span>mozImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  pixelatedZoomCtx<span class="token punctuation">.</span>webkitImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  pixelatedZoomCtx<span class="token punctuation">.</span>msImageSmoothingEnabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">zoom</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span>
        Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>layerX<span class="token punctuation">;</span>
    <span class="token keyword">const</span> y <span class="token operator">=</span> event<span class="token punctuation">.</span>layerY<span class="token punctuation">;</span>
    <span class="token function">zoom</span><span class="token punctuation">(</span>smoothedZoomCtx<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">zoom</span><span class="token punctuation">(</span>pixelatedZoomCtx<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre> <p>The code's usage is demonstrated in the following live example:</p> <p><iframe width="100%" height="300" src="https://mdn.github.io/dom-examples/canvas/pixel-manipulation/image-smoothing.html" loading="lazy"></iframe></p> <p>Also see the source code — <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/image-smoothing.html" rel=" noopener">HTML</a>, <a href="https://github.com/mdn/dom-examples/blob/master/canvas/pixel-manipulation/image-smoothing.js" rel=" noopener">JavaScript</a>.</p>
<h2 id="saving_images">Saving images</h2>
<p>The <a href="../../htmlcanvaselement"><code>HTMLCanvasElement</code></a> provides a <code>toDataURL()</code> method, which is useful when saving images. It returns a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">data URI</a> containing a representation of the image in the format specified by the <code>type</code> parameter (defaults to <a href="https://en.wikipedia.org/wiki/Portable_Network_Graphics" rel=" noopener">PNG</a>). The returned image is in a resolution of 96 dpi.</p> <p><strong>Note:</strong> Be aware that if the canvas contains any pixels that were obtained from another <a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin">origin</a> without using CORS, the canvas is <strong>tainted</strong> and its contents can no longer be read and saved. See <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image#security_and_tainted_canvases">Security and tainted canvases</a> in <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image">Allowing cross-origin use of images and canvas</a></p> <dl> <dt><a href="../../htmlcanvaselement/todataurl"><code>canvas.toDataURL('image/png')</code></a></dt> <dd>Default setting. Creates a PNG image.</dd> <dt><a href="../../htmlcanvaselement/todataurl"><code>canvas.toDataURL('image/jpeg', quality)</code></a></dt> <dd>Creates a JPG image. Optionally, you can provide a quality in the range from 0 to 1, with one being the best quality and with 0 almost not recognizable but small in file size.</dd> </dl> <p>Once you have generated a data URI from you canvas, you are able to use it as the source of any <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/image"><code>&lt;image&gt;</code></a> or put it into a hyper link with a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attr-download">download attribute</a> to save it to disc, for example.</p> <p>You can also create a <a href="../../blob"><code>Blob</code></a> from the canvas.</p> <dl> <dt><a href="../../htmlcanvaselement/toblob"><code>canvas.toBlob(<em>callback</em>, <em>type</em>, <em>encoderOptions</em>)</code></a></dt> <dd>Creates a <code>Blob</code> object representing the image contained in the canvas.</dd> </dl>
<h2 id="see_also">See also</h2>
<ul> <li><a href="../../imagedata"><code>ImageData</code></a></li> <li><a href="../manipulating_video_using_canvas">Manipulating video using canvas</a></li> <li><a href="https://codepo8.github.io/canvas-images-and-pixels/" rel=" noopener">Canvas, images and pixels – by Christian Heilmann</a></li> </ul> 
<ul class="prev-next"> <li><a class="button minimal" href="advanced_animations">« Previous</a></li> <li><a class="button minimal" href="hit_regions_and_accessibility">Next »</a></li> </ul>

    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas</a>
  </p>
</div>
