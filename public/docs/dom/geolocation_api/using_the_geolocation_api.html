<h1>Using the Geolocation API</h1>
<div class="notecard secure">
<strong id="secure_context">Secure context</strong><p>This feature is available only in <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts">secure contexts</a> (HTTPS), in some or all <a href="#browser_compatibility">supporting browsers</a>.</p>
</div> <p>The Geolocation API is used to retrieve the user's location, so that it can for example be used to display their position using a mapping API. This article explains the basics of how to use it.</p>
<h2 id="the_geolocation_object">The geolocation object</h2>
<p>The <a href="../geolocation">Geolocation API</a> is available through the <a href="../navigator/geolocation"><code>navigator.geolocation</code></a> object.</p> <p>If the object exists, geolocation services are available. You can test for the presence of geolocation thusly:</p> <pre data-language="js"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'geolocation'</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* geolocation is available */</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">/* geolocation IS NOT available */</span>
<span class="token punctuation">}</span>
</pre>
<h3 id="getting_the_current_position">Getting the current position</h3>
<p>To obtain the user's current location, you can call the <a href="../geolocation/getcurrentposition"><code>getCurrentPosition()</code></a> method. This initiates an asynchronous request to detect the user's position, and queries the positioning hardware to get up-to-date information. When the position is determined, the defined callback function is executed. You can optionally provide a second callback function to be executed if an error occurs. A third, optional, parameter is an options object where you can set the maximum age of the position returned, the time to wait for a request, and if you want high accuracy for the position.</p> <div class="note notecard"> <p><strong>Note:</strong> By default, <a href="../geolocation/getcurrentposition"><code>getCurrentPosition()</code></a> tries to answer as fast as possible with a low accuracy result. It is useful if you need a quick answer regardless of the accuracy. Devices with a GPS, for example, can take a minute or more to get a GPS fix, so less accurate data (IP location or wifi) may be returned to <code>getCurrentPosition()</code>.</p> </div> <pre data-language="js">navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre> <p>The above example will cause the <code>doSomething()</code> function to execute when the location is obtained.</p>
<h3 id="watching_the_current_position">Watching the current position</h3>
<p>If the position data changes (either by device movement or if more accurate geo information arrives), you can set up a callback function that is called with that updated position information. This is done using the <a href="../geolocation/watchposition"><code>watchPosition()</code></a> function, which has the same input parameters as <a href="../geolocation/getcurrentposition"><code>getCurrentPosition()</code></a>. The callback function is called multiple times, allowing the browser to either update your location as you move, or provide a more accurate location as different techniques are used to geolocate you. The error callback function, which is optional just as it is for <code>getCurrentPosition()</code>, can be called repeatedly.</p> <div class="note notecard"> <p><strong>Note:</strong> You can use <a href="../geolocation/watchposition"><code>watchPosition()</code></a> without an initial <a href="../geolocation/getcurrentposition"><code>getCurrentPosition()</code></a> call.</p> </div> <pre data-language="js"><span class="token keyword">const</span> watchID <span class="token operator">=</span> navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">watchPosition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre> <p>The <a href="../geolocation/watchposition"><code>watchPosition()</code></a> method returns an ID number that can be used to uniquely identify the requested position watcher; you use this value in tandem with the <a href="../geolocation/clearwatch"><code>clearWatch()</code></a> method to stop watching the user's location.</p> <pre data-language="js">navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">clearWatch</span><span class="token punctuation">(</span>watchID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
<h3 id="fine_tuning_the_response">Fine tuning the response</h3>
<p>Both <a href="../geolocation/getcurrentposition"><code>getCurrentPosition()</code></a> and <a href="../geolocation/watchposition"><code>watchPosition()</code></a> accept a success callback, an optional error callback, and an optional <a href="../positionoptions"><code>PositionOptions</code></a> object.</p> <p>This object allows you to specify whether to enable high accuracy, a maximum age for the returned position value (up until this age it will be cached and reused if the same position is requested again; after this the browser will request fresh position data), and a timeout value that dictates how long the browser should attempt to get the position data for, before it times out.</p> <p>A call to <a href="../geolocation/watchposition"><code>watchPosition</code></a> could look like:</p> <pre data-language="js"><span class="token keyword">function</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Sorry, no position available.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  enableHighAccuracy<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  maximumAge<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
  timeout<span class="token operator">:</span> <span class="token number">27000</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> watchID <span class="token operator">=</span> navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">watchPosition</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> error<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></pre>
<h2 id="describing_a_position">Describing a position</h2>
<p>The user's location is described using a <a href="../geolocationposition"><code>GeolocationPosition</code></a> object instance, which itself contains a <a href="../geolocationcoordinates"><code>GeolocationCoordinates</code></a> object instance.</p> <p>The <code>GeolocationPosition</code> instance contains only two things, a <code>coords</code> property that contains the <code>GeolocationCoordinates</code> instance, and a <code>timestamp</code> property that contains a <a href="../domtimestamp"><code>DOMTimeStamp</code></a> instance representing the time at which the position data was retrieved.</p> <p>The <code>GeolocationCoordinates</code> instance contains a number of properties, but the two you'll use most commonly are <code>latitude</code> and <code>longitude</code>, which are what you need to draw your position on a map. Hence many Geolocation success callbacks look fairly simple:</p> <pre data-language="js"><span class="token keyword">function</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> latitude  <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span>
  <span class="token keyword">const</span> longitude <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span>

  <span class="token comment">// Do something with your latitude and longitude</span>
<span class="token punctuation">}</span></pre> <p>You can however get a number of other bits of information from a <code>GeolocationCoordinates</code> object, including altitude, speed, what direction the device is facing, and an accuracy measure of the altitude, longitude, and latitude data.</p>
<h2 id="handling_errors">Handling errors</h2>
<p>The error callback function, if provided when calling <code>getCurrentPosition()</code> or <code>watchPosition()</code>, expects a <code><a href="../geolocationpositionerror">GeolocationPositionError</a></code> object instance as its first parameter. This object type contains two properties, a <code>code</code> indicating what type of error has been returned, and a human-readable <code>message</code> that describes what the error code means.</p> <p>You could use it like so:</p> <pre data-language="js"><span class="token keyword">function</span> <span class="token function">errorCallback</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ERROR(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">): </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
<h2 id="examples">Examples</h2>
<p>In the following example the Geolocation API is used to retrieve the user's latitude and longitude. If sucessful, the available hyperlink is populated with an <code>openstreetmap.org</code> URL that will show their location.</p>
<h3 id="html">HTML</h3>
<pre data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>find-me<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Show my location<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>status<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>map-link<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</pre>
<h3 id="javascript">JavaScript</h3>
<pre data-language="js"><span class="token keyword">function</span> <span class="token function">geoFindMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> status <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#status'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mapLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#map-link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  mapLink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  mapLink<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> latitude  <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span>
    <span class="token keyword">const</span> longitude <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span>

    status<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
    mapLink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://www.openstreetmap.org/#map=18/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latitude<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>longitude<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    mapLink<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Latitude: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>latitude<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> °, Longitude: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>longitude<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> °</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    status<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Unable to retrieve your location'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    status<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Geolocation is not supported by your browser'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    status<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'Locating…'</span><span class="token punctuation">;</span>
    navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#find-me'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> geoFindMe<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
<h3 id="result">Result</h3>
<p><iframe class="sample-code-frame" id="frame_Examples" width="350" height="150" src="https://yari-demos.prod.mdn.mozit.cloud/en-us/docs/web/api/geolocation_api/using_the_geolocation_api/_samples_/Examples" allow="geolocation" loading="lazy"></iframe></p>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API/Using_the_Geolocation_API" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API/Using_the_Geolocation_API</a>
  </p>
</div>
