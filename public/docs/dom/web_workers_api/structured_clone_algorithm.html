<h1>The structured clone algorithm</h1>
<p>The <strong>structured clone algorithm</strong> copies complex JavaScript objects. It is used internally to transfer data between <a href="../worker">Workers</a> via <a href="../worker/postmessage"><code>postMessage()</code></a>, storing objects with <a href="https://developer.mozilla.org/en-US/docs/Glossary/IndexedDB">IndexedDB</a>, or copying objects for <a href="#see_also">other APIs</a>. It clones by recursing through the input object while maintaining a map of previously visited references, to avoid infinitely traversing cycles.</p>
<h2 id="things_that_dont_work_with_structured_clone">Things that don't work with structured clone</h2>
<ul> <li>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function"><code>Function</code></a> objects cannot be duplicated by the structured clone algorithm; attempting to throws a <code>DATA_CLONE_ERR</code> exception.</li> <li>Cloning DOM nodes likewise throws a <code>DATA_CLONE_ERR</code> exception.</li> <li>Certain object properties are not preserved: <ul> <li>The <code>lastIndex</code> property of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp"><code>RegExp</code></a> objects is not preserved.</li> <li>Property descriptors, setters, getters, and similar metadata-like features are not duplicated. For example, if an object is marked readonly with a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor">property descriptor</a>, it will be read/write in the duplicate, since that's the default.</li> <li>The prototype chain is not walked or duplicated.</li> </ul> </li> </ul> <div class="notecard note"> <p><strong>Note</strong>: Native <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error"><code>Error</code></a> types can be cloned in Chrome, and Firefox is <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1556604" rel=" noopener">working on it</a>.</p> </div>
<h2 id="supported_types">Supported types</h2>
<div class="_table"><table class="standard-table"> <thead> <tr> <th scope="col">Object type</th> <th scope="col">Notes</th> </tr> </thead> <tbody> <tr> <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#primitive_values">All primitive types</a></td> <td>However, not symbols.</td> </tr> <tr> <td>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean">Boolean</a> objects</td> <td></td> </tr> <tr> <td>
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/String">String</a> objects</td> <td></td> </tr> <tr> <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a></td> <td></td> </tr> <tr> <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp">RegExp</a></td> <td>
<code>lastIndex</code> is not preserved.</td> </tr> <tr> <td><a href="../blob"><code>Blob</code></a></td> <td></td> </tr> <tr> <td><a href="../file"><code>File</code></a></td> <td></td> </tr> <tr> <td><a href="../filelist"><code>FileList</code></a></td> <td></td> </tr> <tr> <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer">ArrayBuffer</a></td> <td></td> </tr> <tr> <td><a href="../arraybufferview">ArrayBufferView</a></td> <td>Including other <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays">typed arrays</a>.</td> </tr> <tr> <td><a href="../imagebitmap"><code>ImageBitmap</code></a></td> <td></td> </tr> <tr> <td><a href="../imagedata"><code>ImageData</code></a></td> <td></td> </tr> <tr> <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a></td> <td></td> </tr> <tr> <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></td> <td>
<strong>Only</strong> plain objects (e.g. from object literals)</td> </tr> <tr> <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map">Map</a></td> <td></td> </tr> <tr> <td><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set">Set</a></td> <td></td> </tr> </tbody> </table></div>
<h2 id="see_also">See also</h2>
<ul> <li><a href="https://www.w3.org/TR/html5/infrastructure.html#safe-passing-of-structured-data" rel=" noopener">HTML Specification: Safe passing of structured data</a></li> <li><a href="../window/history"><code>window.history</code></a></li> <li><a href="../window/postmessage"><code>window.postMessage()</code></a></li> <li><a href="../web_workers_api">Web Workers</a></li> <li><a href="../indexeddb_api">IndexedDB</a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Components.utils.cloneInto">Components.utils.cloneInto</a></li> </ul>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm</a>
  </p>
</div>
