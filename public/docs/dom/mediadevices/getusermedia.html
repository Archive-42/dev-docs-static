<h1>MediaDevices.getUserMedia()</h1> <p>The <a href="../mediadevices"><code>MediaDevices</code></a><code><strong>.getUserMedia()</strong></code> method prompts the user for permission to use a media input which produces a <a href="../mediastream"><code>MediaStream</code></a> with tracks containing the requested types of media. That stream can include, for example, a video track (produced by either a hardware or virtual video source such as a camera, video recording device, screen sharing service, and so forth), an audio track (similarly, produced by a physical or virtual audio source like a microphone, A/D converter, or the like), and possibly other track types.</p> <p>It returns a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> that resolves to a <a href="../mediastream"><code>MediaStream</code></a> object. If the user denies permission, or matching media is not available, then the promise is rejected with <code>NotAllowedError</code> or <code>NotFoundError</code> respectively.</p> <div class="note notecard"> <p><strong>Note:</strong> It's possible for the returned promise to <em>neither</em> resolve nor reject, as the user is not required to make a choice at all and may ignore the request.</p> </div> <p>Generally, you will access the <a href="../mediadevices"><code>MediaDevices</code></a> singleton object using <a href="../navigator/mediadevices"><code>navigator.mediaDevices</code></a>, like this:</p> <pre data-language="js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getMedia</span><span class="token punctuation">(</span><span class="token parameter">constraints</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> stream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    stream <span class="token operator">=</span> <span class="token keyword">await</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* use the stream */</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* handle the error */</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre> <p>Similarly, using the raw promises directly, the code looks like this:</p> <pre data-language="js">navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* use the stream */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/* handle the error */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre> <div class="notecard note"> <p><strong>Note:</strong> If the current document isn't loaded securely, <code>navigator.mediaDevices</code> will be <code>undefined</code>, and you cannot use <code>getUserMedia()</code>. See <a href="#security">Security</a> for more information on this and other security issues related to using <code>getUserMedia()</code>.</p> </div>
<h2 id="syntax">Syntax</h2>
<pre data-language="js"><span class="token keyword">var</span> promise <span class="token operator">=</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
<h3 id="parameters">Parameters</h3>
<dl> <dt><code><var>constraints</var></code></dt> <dd> <p>A <a href="../mediastreamconstraints"><code>MediaStreamConstraints</code></a> object specifying the types of media to request, along with any requirements for each type.</p> <p>The <code><var>constraints</var></code> parameter is a <code>MediaStreamConstraints</code> object with two members: <code>video</code> and <code>audio</code>, describing the media types requested. Either or both must be specified. If the browser cannot find all media tracks with the specified types that meet the constraints given, then the returned promise is rejected with <code>NotFoundError</code>.</p> <p>The following requests both audio and video without any specific requirements:</p> <pre data-language="js"><span class="token punctuation">{</span> audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> video<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></pre> <p>If <code>true</code> is specified for a media type, the resulting stream is <em>required</em> to have that type of track in it. If one cannot be included for any reason, the call to <code>getUserMedia()</code> will result in an error.</p> <p>While information about a user's cameras and microphones are inaccessible for privacy reasons, an application can request the camera and microphone capabilities it needs and wants, using additional constraints. The following expresses a preference for 1280x720 camera resolution:</p> <pre data-language="js"><span class="token punctuation">{</span>
  audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token operator">:</span> <span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">720</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre> <p id="successCallback">The browser will try to honour this, but may return other resolutions if an exact match is not available, or the user overrides it.</p> <p>To <em>require</em> a capability, use the keywords <code>min</code>, <code>max</code>, or <code>exact</code> (a.k.a. <code>min == max</code>). The following demands a minimum resolution of 1280x720:</p> <pre data-language="js"><span class="token punctuation">{</span>
  audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token operator">:</span> <span class="token punctuation">{</span>
    width<span class="token operator">:</span> <span class="token punctuation">{</span> min<span class="token operator">:</span> <span class="token number">1280</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    height<span class="token operator">:</span> <span class="token punctuation">{</span> min<span class="token operator">:</span> <span class="token number">720</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre> <p>If no camera exists with this resolution or higher, then the returned promise will be rejected with <code>OverconstrainedError</code>, and the user will not be prompted.</p> <p>The reason for the difference in behavior is that the keywords <code>min</code>, <code>max</code>, and <code>exact</code> are inherently mandatory. Whereas plain values and a keyword called <code>ideal</code> are not. Here's a full example:</p> <pre data-language="js"><span class="token punctuation">{</span>
  audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token operator">:</span> <span class="token punctuation">{</span>
    width<span class="token operator">:</span> <span class="token punctuation">{</span> min<span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> ideal<span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">1920</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    height<span class="token operator">:</span> <span class="token punctuation">{</span> min<span class="token operator">:</span> <span class="token number">576</span><span class="token punctuation">,</span> ideal<span class="token operator">:</span> <span class="token number">720</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">1080</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre> <p>An <code>ideal</code> value, when used, has gravity, which means that the browser will try to find the setting (and camera, if you have more than one), with the smallest <a href="https://w3c.github.io/mediacapture-main/#dfn-fitness-distance" rel=" noopener">fitness distance</a> from the ideal values given.</p> <p>Plain values are inherently ideal, which means that the first of our resolution examples above could have been written like this:</p> <pre data-language="js"><span class="token punctuation">{</span>
  audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token operator">:</span> <span class="token punctuation">{</span>
    width<span class="token operator">:</span> <span class="token punctuation">{</span> ideal<span class="token operator">:</span> <span class="token number">1280</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    height<span class="token operator">:</span> <span class="token punctuation">{</span> ideal<span class="token operator">:</span> <span class="token number">720</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre> <p>Not all constraints are numbers. For example, on mobile devices, the following will prefer the front camera (if one is available) over the rear one:</p> <pre data-language="js"><span class="token punctuation">{</span> audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> video<span class="token operator">:</span> <span class="token punctuation">{</span> facingMode<span class="token operator">:</span> <span class="token string">"user"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></pre> <p>To <em>require</em> the rear camera, use:</p> <pre data-language="js"><span class="token punctuation">{</span> audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> video<span class="token operator">:</span> <span class="token punctuation">{</span> facingMode<span class="token operator">:</span> <span class="token punctuation">{</span> exact<span class="token operator">:</span> <span class="token string">"environment"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></pre> <p>Another non-number constraint is the <code>deviceId</code> constraint. If you have a <code>deviceId</code> from <a href="enumeratedevices"><code>mediaDevices.enumerateDevices()</code></a>, you can use it to request a specific device:</p> <pre data-language="js"><span class="token punctuation">{</span> video<span class="token operator">:</span> <span class="token punctuation">{</span> deviceId<span class="token operator">:</span> myPreferredCameraDeviceId <span class="token punctuation">}</span> <span class="token punctuation">}</span></pre> <p>The above will return the camera you requested, or a different camera if that specific camera is no longer available. Again, to <em>require</em> the specific camera, you would use:</p> <pre data-language="js"><span class="token punctuation">{</span> video<span class="token operator">:</span> <span class="token punctuation">{</span> deviceId<span class="token operator">:</span> <span class="token punctuation">{</span> exact<span class="token operator">:</span> myExactCameraOrBustDeviceId <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span></pre> </dd> </dl>
<h3 id="return_value">Return value</h3>
<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a> whose fulfillment handler receives a <a href="../mediastream"><code>MediaStream</code></a> object when the requested media has successfully been obtained.</p>
<h3 id="exceptions">Exceptions</h3>
<p>Rejections of the returned promise are made by passing a <a href="../domexception"><code>DOMException</code></a> error object to the promise's failure handler. Possible errors are:</p> <dl> <dt><code>AbortError</code></dt> <dd>Although the user and operating system both granted access to the hardware device, and no hardware issues occurred that would cause a <code>NotReadableError</code>, some problem occurred which prevented the device from being used.</dd> <dt><code>NotAllowedError</code></dt> <dd>One or more of the requested source devices cannot be used at this time. This will happen if the browsing context is insecure (that is, the page was loaded using HTTP rather than HTTPS). It also happens if the user has specified that the current browsing instance is not permitted access to the device, the user has denied access for the current session, or the user has denied all access to user media devices globally. On browsers that support managing media permissions with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Feature_Policy">Feature Policy</a>, this error is returned if Feature Policy is not configured to allow access to the input source(s). <div class="note notecard">Older versions of the specification used <code>SecurityError</code> for this instead; <code>SecurityError</code> has taken on a new meaning.</div> </dd> <dt><code>NotFoundError</code></dt> <dd>No media tracks of the type specified were found that satisfy the given constraints. </dd> <dt><code>NotReadableError</code></dt> <dd>Although the user granted permission to use the matching devices, a hardware error occurred at the operating system, browser, or Web page level which prevented access to the device.</dd> <dt><code>OverconstrainedError</code></dt> <dd>The specified constraints resulted in no candidate devices which met the criteria requested. The error is an object of type <code>OverconstrainedError</code>, and has a <code>constraint</code> property whose string value is the name of a constraint which was impossible to meet, and a <code>message</code> property containing a human-readable string explaining the problem. <div class="note notecard">Because this error can occur even when the user has not yet granted permission to use the underlying device, it can potentially be used as a fingerprinting surface.</div> </dd> <dt><code>SecurityError</code></dt> <dd>User media support is disabled on the <a href="../document"><code>Document</code></a> on which <code>getUserMedia()</code> was called. The mechanism by which user media support is enabled and disabled is left up to the individual user agent.</dd> <dt><code>TypeError</code></dt> <dd>The list of constraints specified is empty, or has all constraints set to <code>false</code>. This can also happen if you try to call <code>getUserMedia()</code> in an insecure context, since <a href="../navigator/mediadevices"><code>navigator.mediaDevices</code></a> is <code>undefined</code> in an insecure context.</dd> </dl>
<h2 id="privacy_and_security">Privacy and security</h2>
<p>As an API that may involve significant privacy concerns, <code>getUserMedia()</code>'s specification lays out a wide array of privacy and security requirements that browsers are obligated to meet.</p> <p><code>getUserMedia()</code> is a powerful feature which can only be used in <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts">secure contexts</a>; in insecure contexts, <code>navigator.mediaDevices</code> is <code>undefined</code>, preventing access to <code>getUserMedia()</code>. A secure context is, in short, a page loaded using HTTPS or the <code>file:///</code> URL scheme, or a page loaded from <code>localhost</code>.</p> <p>In addition, user permission is always required to access the user's audio and video inputs. Only a window's top-level document context for a valid origin can even request permission to use <code>getUserMedia()</code>, unless the top-level context expressly grants permission for a given <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe"><code>&lt;iframe&gt;</code></a> to do so using <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Feature_Policy">Feature Policy</a>. Otherwise, the user will never even be asked for permission to use the input devices.</p> <p>For additional details on these requirements and rules, how they are reflected in the context in which your code is running, and about how browsers manage user privacy and security issues, read on.</p>
<h3 id="user_privacy">User privacy</h3>
<p>As an API that may involve significant privacy concerns, <code>getUserMedia()</code> is held by the specification to very specific requirements for user notification and permission management. First, <code>getUserMedia()</code> must always get user permission before opening any media gathering input such as a webcam or microphone. Browsers may offer a once-per-domain permission feature, but they must ask at least the first time, and the user must specifically grant ongoing permission if they choose to do so.</p> <p>Of equal importance are the rules around notification. Browsers are required to display an indicator that shows that a camera or microphone is in use, above and beyond any hardware indicator that may exist. They must also show an indicator that permission has been granted to use a device for input, even if the device is not actively recording at the moment.</p> <p>For example in Firefox, the URL bar displays a pulsing red icon to indicate that recording is underway. The icon is gray if the permission is in place but recording is not currently underway. The device's physical light is used to indicate whether or not recording is currently active. If you've muted your camera (so-called "facemuting"), your camera's activity light goes out to indicate that the camera is not actively recording you, without discarding the permission to resume using the camera once muting is over.</p>
<h3 id="security">Security</h3>
<p>There are a number of ways security management and controls in a <a href="https://developer.mozilla.org/en-US/docs/Glossary/User_agent">user agent</a> can cause <code>getUserMedia()</code> to return a security-related error.</p> <div class="notecard note"> <p><strong>Note:</strong> The security model for <code>getUserMedia()</code> is still somewhat in flux. The originally-designed security mechanism is in the process of being replaced with Feature Policy, so various browsers have different levels of security support, using different mechanisms. You should test your code carefully on a variety of devices and browsers to be sure it is as broadly compatible as possible</p> </div> <h4 id="feature_policy">Feature Policy</h4> <p>The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Feature_Policy">Feature Policy</a> security management feature of <a href="https://developer.mozilla.org/en-US/docs/Glossary/HTTP">HTTP</a> is in the process of being introduced into browsers, with support available to some extent in many browsers (though not always enabled by default, as in Firefox). <code>getUserMedia()</code> is one method which will require the use of Feature Policy, and your code needs to be prepared to deal with this. For example, you may need to use the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-allow"><code>allow</code></a> attribute on any <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe"><code>&lt;iframe&gt;</code></a> that uses <code>getUserMedia()</code>, and pages that use <code>getUserMedia()</code> will eventually need to supply the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Feature-Policy"><code>Feature-Policy</code></a> header.</p> <p>The two permissions that apply to <code>getUserMedia()</code> are <code>camera</code> and <code>microphone</code>.</p> <p>For example, this line in the HTTP headers will enable use of a camera for the document and any embedded <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe"><code>&lt;iframe&gt;</code></a> elements that are loaded from the same origin:</p> <pre class="notranslate">Feature-Policy: camera 'self'</pre> <p>This will request access to the microphone for the current origin and the specific origin https://developer.mozilla.org:</p> <pre class="notranslate">Feature-Policy: microphone 'self' https://developer.mozilla.org</pre> <p>If you're using <code>getUserMedia()</code> within an <code>&lt;iframe&gt;</code>, you can request permission just for that frame, which is clearly more secure than requesting a more general permission. Here, indicate we need the ability to use both camera and microphone:</p> <pre data-language="html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://mycode.example.net/etc<span class="token punctuation">"</span></span> <span class="token attr-name">allow</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>camera;microphone<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span></pre> <p>Read our guide, <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Feature_Policy/Using_Feature_Policy">Using Feature Policy</a>, to learn more about how it works.</p> <h4 id="encryption_based_security">Encryption based security</h4> <p>The <code>getUserMedia()</code> method is only available in <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts">secure contexts</a>. A secure context is one the browser is reasonably confident contains a document which was loaded securely, using HTTPS/TLS, and has limited exposure to insecure contexts. If a document isn't loaded in a secure context, the <a href="../navigator/mediadevices"><code>navigator.mediaDevices</code></a> property is <code>undefined</code>, making access to <code>getUserMedia()</code> impossible.</p> <p>Attempting to access <code>getUserMedia()</code> in this situation will result in a <code>TypeError</code>.</p> <h4 id="document_source_security">Document source security</h4> <p>Because of the obvious security concern associated with <code>getUserMedia()</code> if used unexpectedly or without security being carefully managed, it can only be used in secure contexts. There are a number of insecure ways to load a document that might, in turn, attempt to call <code>getUserMedia()</code>. The following are examples of situations in which <code>getUserMedia()</code> is not permitted to be called:</p> <ul> <li>A document loaded into a sandboxed <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe"><code>&lt;iframe&gt;</code></a> element cannot call <code>getUserMedia()</code> unless the <code>&lt;iframe&gt;</code> has its <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-sandbox"><code>sandbox</code></a> attribute set to <code>allow-same-origin</code>. </li> <li>A document loaded using a <code>data://</code> or <code>blob://</code> URL which has no origin (such as when one of these URLs is typed by the user into the address bar) cannot call <code>getUserMedia()</code>. These kinds of URLs loaded from JavaScript code inherit the script's permissions.</li> <li>Any other situation in which there is no origin, such as when the <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#attr-srcdoc"><code>srcdoc</code></a> attribute is used to specify the contents of a frame.</li> </ul>
<h2 id="examples">Examples</h2>
<h3 id="width_and_height">Width and height</h3>
<p>This example gives a preference for camera resolution, and assigns the resulting <a href="../mediastream"><code>MediaStream</code></a> object to a video element.</p> <pre data-language="js"><span class="token comment">// Prefer camera resolution nearest to 1280x720.</span>
<span class="token keyword">var</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span> audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> video<span class="token operator">:</span> <span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">720</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mediaStream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  video<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> mediaStream<span class="token punctuation">;</span>
  video<span class="token punctuation">.</span><span class="token function-variable function">onloadedmetadata</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// always check for errors at the end.</span>
</pre>
<h3 id="using_the_new_api_in_older_browsers">Using the new API in older browsers</h3>
<p>Here's an example of using <code>navigator.mediaDevices.getUserMedia()</code>, with a polyfill to cope with older browsers. Note that this polyfill does not correct for legacy differences in constraints syntax, which means constraints won't work well across browsers. It is recommended to use the <a href="https://github.com/webrtc/adapter" rel=" noopener">adapter.js</a> polyfill instead, which does handle constraints.</p> <pre data-language="js"><span class="token comment">// Older browsers might not implement mediaDevices at all, so we set an empty object first</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>mediaDevices <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>mediaDevices <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Some browsers partially implement mediaDevices. We can't just assign an object</span>
<span class="token comment">// with getUserMedia as it would overwrite existing properties.</span>
<span class="token comment">// Here, we will just add the getUserMedia property if it's missing.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span>getUserMedia <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function-variable function">getUserMedia</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">constraints</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// First get ahold of the legacy getUserMedia, if present</span>
    <span class="token keyword">var</span> getUserMedia <span class="token operator">=</span> navigator<span class="token punctuation">.</span>webkitGetUserMedia <span class="token operator">||</span> navigator<span class="token punctuation">.</span>mozGetUserMedia<span class="token punctuation">;</span>

    <span class="token comment">// Some browsers just don't implement it - return a rejected promise with an error</span>
    <span class="token comment">// to keep a consistent interface</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>getUserMedia<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'getUserMedia is not implemented in this browser'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Otherwise, wrap the call to the old navigator.getUserMedia with a Promise</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">getUserMedia</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>navigator<span class="token punctuation">,</span> constraints<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span> audio<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> video<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Older browsers may not have srcObject</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"srcObject"</span> <span class="token keyword">in</span> video<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    video<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Avoid using this in new browsers, as it is going away.</span>
    video<span class="token punctuation">.</span>src <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  video<span class="token punctuation">.</span><span class="token function-variable function">onloadedmetadata</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">": "</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre>
<h3 id="frame_rate">Frame rate</h3>
<p>Lower frame-rates may be desirable in some cases, like WebRTC transmissions with bandwidth restrictions.</p> <pre data-language="js"><span class="token keyword">var</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span> video<span class="token operator">:</span> <span class="token punctuation">{</span> frameRate<span class="token operator">:</span> <span class="token punctuation">{</span> ideal<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token number">15</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
<h3 id="front_and_back_camera">Front and back camera</h3>
<p>On mobile phones.</p> <pre data-language="js"><span class="token keyword">var</span> front <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'flip-button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> front <span class="token operator">=</span> <span class="token operator">!</span>front<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span> video<span class="token operator">:</span> <span class="token punctuation">{</span> facingMode<span class="token operator">:</span> <span class="token punctuation">(</span>front<span class="token operator">?</span> <span class="token string">"user"</span> <span class="token operator">:</span> <span class="token string">"environment"</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre>
<h2 id="specifications">Specifications</h2>
<div class="_table"><table class="standard-table"> <thead> <tr> <th scope="col">Specification</th> <th scope="col">Status</th> <th scope="col">Comment</th> </tr> </thead> <tbody> <tr> <td><a href="https://w3c.github.io/mediacapture-main/#dom-mediadevices-getusermedia" hreflang="en" rel=" noopener">Media Capture and Streams<br><small>The definition of 'MediaDevices.getUserMedia()' in that specification.</small></a></td> <td><span class="spec-cr">Candidate Recommendation</span></td> <td>Initial definition</td> </tr> </tbody> </table></div>
<h2 id="browser_compatibility">Browser compatibility</h2>
<table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="6">Desktop</th>
<th colspan="6">Mobile</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Internet Explorer</th>
<th>Opera</th>
<th>Safari</th>
<th>WebView Android</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
</tr>
</thead>
<tbody>
<tr>
<th><code>getUserMedia</code></th>
<td class="bc-supports-yes">
<div>53</div>
<div>If you need this capability before version 53, refer to <code>navigator.webkitGetUserMedia</code>, a prefixed form of the deprecated <a href="https://developer.mozilla.org/docs/Web/API/Navigator/getUserMedia"><code>navigator.getUserMedia</code></a> API.</div>
</td>
<td class="bc-supports-yes"><div>12</div></td>
<td class="bc-supports-yes">
<div>36</div>
<div>["If you need this capability before version 36, refer to <code>navigator.mozGetUserMedia</code>, a prefixed form of the deprecated <a href="https://developer.mozilla.org/docs/Web/API/Navigator/getUserMedia"><code>navigator.getUserMedia</code></a> API.", "Before Firefox 55, <code>getUserMedia()</code> incorrectly returns <code>NotSupportedError</code> when the list of constraints specified is empty, or has all constraints set to <code>false</code>. Starting in Firefox 55, this situation now correctly calls the failure handler with a <code>TypeError</code>.", "When using the Firefox-specific <code>video</code> constraint called <code>mediaSource</code> to request display capture, Firefox 66 and later consider values of <code>screen</code> and <code>window</code> to both cause a list of screens <em>and</em> windows to be shown.", "Starting in Firefox 66, <code>getUserMedia()</code> can no longer be used in sandboxed <code>&lt;iframe&gt;</code>s or <code>data</code> URLs entered in the address bar by the user."]</div>
</td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes">
<div>40</div>
<div>If you need this capability before version 40, refer to <code>navigator.webkitGetUserMedia</code>, a prefixed form of the deprecated <a href="https://developer.mozilla.org/docs/Web/API/Navigator/getUserMedia"><code>navigator.getUserMedia</code></a> API.</div>
</td>
<td class="bc-supports-yes"><div>11</div></td>
<td class="bc-supports-yes"><div>53</div></td>
<td class="bc-supports-yes">
<div>53</div>
<div>If you need this capability before version 53, refer to <code>navigator.webkitGetUserMedia</code>, a prefixed form of the deprecated <a href="https://developer.mozilla.org/docs/Web/API/Navigator/getUserMedia"><code>navigator.getUserMedia</code></a> API.</div>
</td>
<td class="bc-supports-yes">
<div>36</div>
<div>["If you need this capability before version 36, refer to <code>navigator.mozGetUserMedia</code>, a prefixed form of the deprecated <a href="https://developer.mozilla.org/docs/Web/API/Navigator/getUserMedia"><code>navigator.getUserMedia</code></a> API.", "Before Firefox 55, <code>getUserMedia()</code> incorrectly returns <code>NotSupportedError</code> when the list of constraints specified is empty, or has all constraints set to <code>false</code>. Starting in Firefox 55, this situation now correctly calls the failure handler with a <code>TypeError</code>.", "When using the Firefox-specific <code>video</code> constraint called <code>mediaSource</code> to request display capture, Firefox 66 and later consider values of <code>screen</code> and <code>window</code> to both cause a list of screens <em>and</em> windows to be shown.", "Starting in Firefox 66, <code>getUserMedia()</code> can no longer be used in sandboxed <code>&lt;iframe&gt;</code>s or <code>data</code> URLs entered in the address bar by the user."]</div>
</td>
<td class="bc-supports-yes">
<div>41</div>
<div>If you need this capability before version 41, refer to <code>navigator.webkitGetUserMedia</code>, a prefixed form of the deprecated <a href="https://developer.mozilla.org/docs/Web/API/Navigator/getUserMedia"><code>navigator.getUserMedia</code></a> API.</div>
</td>
<td class="bc-supports-yes"><div>11</div></td>
<td class="bc-supports-yes"><div>6.0</div></td>
</tr>
<tr>
<th><code>secure_context_required</code></th>
<td class="bc-supports-yes"><div>53</div></td>
<td class="bc-supports-yes"><div>79</div></td>
<td class="bc-supports-yes"><div>68</div></td>
<td class="bc-supports-no"><div>No</div></td>
<td class="bc-supports-yes"><div>40</div></td>
<td class="bc-supports-yes"><div>?</div></td>
<td class="bc-supports-yes"><div>53</div></td>
<td class="bc-supports-yes"><div>53</div></td>
<td class="bc-supports-yes"><div>68</div></td>
<td class="bc-supports-yes"><div>41</div></td>
<td class="bc-supports-yes"><div>?</div></td>
<td class="bc-supports-yes"><div>6.0</div></td>
</tr>
</tbody>
</table>


<h2 id="see_also">See also</h2>
<ul> <li>The older <a href="../navigator/getusermedia"><code>navigator.getUserMedia()</code></a> legacy API.</li> <li>
<a href="enumeratedevices"><code>mediaDevices.enumerateDevices()</code></a>: Listing available media devices</li> <li><a href="../webrtc_api">WebRTC API</a></li> <li><a href="../media_streams_api">Media Capture and Streams API (Media Streams)</a></li> <li>
<a href="../screen_capture_api">Screen Capture API</a>: Capturing screen contents as a <a href="../mediastream"><code>MediaStream</code></a>
</li> <li>
<a href="getdisplaymedia"><code>mediaDevices.getDisplayMedia()</code></a>: Getting a stream containing screen contents</li> <li>
<a href="../webrtc_api/taking_still_photos">Taking webcam photos</a>: A tutorial on using <code>getUserMedia()</code> to take still photos rather than video</li> </ul>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia</a>
  </p>
</div>
